// Dentro da função App() do React
// ...
React.useEffect(() => {
    // Verifica se a promessa de inicialização do Supabase está disponível
    if (window.supabaseClientReadyPromise) {
        window.supabaseClientReadyPromise
            .then(client => {
                // Quando a promessa resolve, o cliente Supabase está pronto
                setSupabase(client); // Define o cliente Supabase no estado React
                setIsSupabaseClientReady(true);
                console.log("[App] Cliente Supabase pronto via promise.");
            })
            .catch(error => {
                // Se a promessa for rejeitada (erro na inicialização do Supabase)
                console.error("[App] Erro ao obter cliente Supabase via promise:", error);
                setModalMessage("Erro crítico: Não foi possível ligar ao serviço de base de dados. Por favor, recarregue a página.", "error");
                setIsModalOpen(true);
                setIsSupabaseClientReady(false); // Garante que o estado de pronto não seja ativado
            });
    } else {
        // Fallback: Se a promessa não estiver imediatamente disponível (o que não deveria acontecer com a ordem correta dos scripts)
        console.warn("[App] supabaseClientReadyPromise não disponível. Tentando fallback com setInterval...");
        const maxTries = 20; // Tentar por até 20 * 100ms = 2 segundos
        let currentTry = 0;
        const intervalId = setInterval(() => {
            if (window.globalSupabaseClient) {
                setSupabase(window.globalSupabaseClient);
                setIsSupabaseClientReady(true);
                console.log("[App] Cliente Supabase inicializado globalmente após atraso/tentativa (fallback).");
                clearInterval(intervalId);
            } else if (currentTry >= maxTries) {
                console.error("[App] Falha ao inicializar o cliente Supabase após várias tentativas (fallback). Verifique 'supabaseClientInstance.js' e variáveis.");
                setModalMessage("Erro crítico: Não foi possível ligar ao serviço de base de dados. Por favor, recarregue a página.", "error");
                setIsModalOpen(true);
                clearInterval(intervalId);
            }
            currentTry++;
        }, 100);
        return () => clearInterval(intervalId);
    }
}, []); // Este useEffect deve ser executado apenas uma vez
// ...
